from bson import ObjectId

from digipay import mongo_to_oracle

MONGO_QUERY_all={}
MONGO_QUERY_1397= {"creationDate":{"$gte":0, "$lt":1553113800000}}               # >=0             and <1398-01-01
MONGO_QUERY_1398= {"creationDate":{"$gte":1553113800000, "$lt":1584649800000}}   # >=1398-01-01    and <1399-01-01
MONGO_QUERY_1399_1= {"creationDate":{"$gte":1584649800000, "$lt":1587324600000}}
MONGO_QUERY_1399_2= {"creationDate":{"$gte":1587324600000, "$lt":1590003000000}}
MONGO_QUERY_1399_3= {"creationDate":{"$gte":1590003000000, "$lt":1592681400000}}
MONGO_QUERY_1399_4= {"creationDate":{"$gte":1592681400000, "$lt":1595359800000}}
MONGO_QUERY_1399_5= {"creationDate":{"$gte":1595359800000, "$lt":1598038200000}}
MONGO_QUERY_1399_6= {"creationDate":{"$gte":1598038200000, "$lt":1600720200000}}
MONGO_QUERY_1399_7= {"creationDate":{"$gte":1600720200000, "$lt":1603312200000}}
MONGO_QUERY_1399_8= {"creationDate":{"$gte":1603312200000, "$lt":1605904200000}}
MONGO_QUERY_1399_9= {"creationDate":{"$gte":1605904200000, "$lt":1608496200000}}
MONGO_QUERY_1399_10={"creationDate":{"$gte":1608496200000, "$lt":1611088200000}}
MONGO_QUERY_1399_11={"creationDate":{"$gte":1611088200000}}
MONGO_QUERY_id= {"_id" : ObjectId('5f5e0246ebeb6105689ccc19')}


MONGO_URI = "mongodb://ops:ops%402020@172.16.27.11:27018/?serverSelectionTimeoutMS=12000000&authSource=admin&authMechanism=SCRAM-SHA-256&connectTimeoutMS=12000000&socketTimeoutMS=12000000&readPreference=secondaryPreferred"
MONGO_DB = "switch_credit_db"
# MONGO_QUERY= MONGO_QUERY_all
MONGO_QUERY= MONGO_QUERY_1399_11
# MONGO_QUERY= MONGO_QUERY_id
MONGO_COLLECTION="activations"
ORACLE_USER = "stage"
ORACLE_PASS = "stage"
ORACLE_DSN = "172.18.24.84/orcl"
DEST_TABLE_NAME= 'switch_credit_activations'
# COLUMN_TYPE="varchar2(2000)"

def clean_data(data):
    if len(data)>0:
        data["steps"] = data["steps"].apply(lambda x: x[:2000] )

mongo_to_oracle.etl(MONGO_URI,MONGO_DB,MONGO_COLLECTION,MONGO_QUERY,ORACLE_DSN,ORACLE_USER,ORACLE_PASS,DEST_TABLE_NAME
                    ,mode='append',mongo_limit=0,dest_column_type='varchar2(4000)'
                    ,chunk_size=0,fn_clean_data=clean_data)


#  create table SWITCH_CREDIT_ACTIVATIONS(
# ID VARCHAR2(36),
# CELLNUMBER VARCHAR2(36),
# USERID VARCHAR2(36),
# STEPS VARCHAR2(4000),
# STATUS VARCHAR2(50),
# CREATIONDATE VARCHAR2(20),
# DUEDATE VARCHAR2(20),
# VERSION VARCHAR2(20),
# CLASS VARCHAR2(150),
# INITIALBALANCE VARCHAR2(20),
# INSTALLMENTCOUNT VARCHAR2(20),
# GROUP_TITLE VARCHAR2(150),
# GROUP_GROUPID VARCHAR2(36),
# GROUP_RULEID VARCHAR2(36),
# GROUP_FUNDPROVIDER_ID VARCHAR2(36),
# GROUP_FUNDPROVIDER_BUSINESSID VARCHAR2(36),
# GROUP_FUNDPROVIDER_ACTIVATIONTIME VARCHAR2(20),
# GROUP_FUNDPROVIDER_MODIFICATIONTIME VARCHAR2(20),
# GROUP_FUNDPROVIDER_NAME VARCHAR2(150),
# GROUP_FUNDPROVIDER_CRN VARCHAR2(150),
# GROUP_FUNDPROVIDER_CODE VARCHAR2(4000),
# GROUP_CREATIONTIME VARCHAR2(20),
# GROUP_USERENTRYPOINT VARCHAR2(150),
# GROUP_ACTIVE VARCHAR2(20),
# GROUP_VERSION VARCHAR2(20),
# COMPLETEDDATE VARCHAR2(20),
# STATUSMODIFICATIONDATE VARCHAR2(20),
# GROUP_FUNDPROVIDER_ACTIVE VARCHAR2(20),
# GROUP_ID VARCHAR2(20),
# IBAN VARCHAR2(50),
# EDITED VARCHAR2(150)
#            )
# ;
